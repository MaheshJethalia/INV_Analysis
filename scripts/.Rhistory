#      panel.background = element_rect(fill = 'black'),legend.background = element_rect(fill = "black", color = NA),
#      legend.key = element_rect(color = "gray", fill = "black"), legend.title = element_text(color = "white"), legend.text = element_text(color = "white"))+
geom_text(aes(x=NES,y=-log10(Padj),label=MR),
data=temp_df,
hjust = 0, vjust = 0, nudge_x = 0.01, angle = 45,
size = 4, check_overlap = T) +
ggtitle("Significance vs NES for Common MRs") + theme(text = element_text(size=16,color="black")) + theme(axis.text = element_text(size=14, color="black")) + theme(plot.title = element_text(hjust = 0.5,color="black")) + coord_fixed(ratio=0.7)
p2
output_df$Cancer
unique(output_df$Cancer)
output_df <- read.table("../Results/Paper_Text/All_TF_Activity_Information_v2.csv",header = TRUE)
colors <- c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#a9a9a9', '#008080', '#e6beff', '#00000f','#f00000')
output_df$MR <- as.character(as.vector(output_df$MR))
output_df$Cancer <- as.character(as.vector(output_df$Cancer))
#Get only thoe master regulators which are very significant
temp_df <- output_df[-log10(output_df$Padj)>=4.0,]
p2 <- ggplot(output_df, aes(x = NES, y = -log10(Padj),
shape = Cancer
)) +
geom_rect(data=NULL,aes(xmin=-4,xmax=0,ymin=-Inf,ymax=Inf),
fill="blue")+
geom_rect(data=NULL,aes(xmin=0,xmax=4,ymin=-Inf,ymax=Inf),
fill="red")+
geom_point()+
geom_point(data=output_df[output_df$Cancer==all_inv[1],], aes(x=NES, y=-log10(Padj), color=all_inv[1]))+
geom_point(data=output_df[output_df$Cancer==all_inv[2],], aes(x=NES, y=-log10(Padj), color=all_inv[2]))+
geom_point(data=output_df[output_df$Cancer==all_inv[3],], aes(x=NES, y=-log10(Padj), color=all_inv[3]))+
geom_point(data=output_df[output_df$Cancer==all_inv[4],], aes(x=NES, y=-log10(Padj), color=all_inv[4]))+
geom_point(data=output_df[output_df$Cancer==all_inv[5],], aes(x=NES, y=-log10(Padj), color=all_inv[5]))+
geom_point(data=output_df[output_df$Cancer==all_inv[6],], aes(x=NES, y=-log10(Padj), color=all_inv[6]))+
geom_point(data=output_df[output_df$Cancer==all_inv[7],], aes(x=NES, y=-log10(Padj), color=all_inv[7]))+
geom_point(data=output_df[output_df$Cancer==all_inv[8],], aes(x=NES, y=-log10(Padj), color=all_inv[8]))+
geom_point(data=output_df[output_df$Cancer==all_inv[9],], aes(x=NES, y=-log10(Padj), color=all_inv[9]))+
geom_point(data=output_df[output_df$Cancer==all_inv[10],], aes(x=NES, y=-log10(Padj), color=all_inv[10]))+
xlab("Normalized Enrichment Scores (NES)") + ylab("-log10(Padj)") +
scale_shape_manual(name = "Cancer", values = 1:nlevels(as.factor(output_df$Cancer))) +
scale_color_manual(name = "Cancer", values =  colors) +
geom_hline(yintercept=c(0,-log10(0.05),4),color=c("black","green","yellow")) + geom_vline(xintercept = 0) + xlim(c(-4,4)) + ylim(c(0,6)) +
theme_minimal() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
#theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),plot.background=element_rect(fill = "black"),
#      panel.background = element_rect(fill = 'black'),legend.background = element_rect(fill = "black", color = NA),
#      legend.key = element_rect(color = "gray", fill = "black"), legend.title = element_text(color = "white"), legend.text = element_text(color = "white"))+
geom_text(aes(x=NES,y=-log10(Padj),label=MR),
data=temp_df,
hjust = 0, vjust = 0, nudge_x = 0.01, angle = 45,
size = 4, check_overlap = T) +
ggtitle("Significance vs NES for Common MRs") + theme(text = element_text(size=16,color="black")) + theme(axis.text = element_text(size=14, color="black")) + theme(plot.title = element_text(hjust = 0.5,color="black")) + coord_fixed(ratio=0.7)
p2
output_df <- read.table("../Results/Paper_Text/All_TF_Activity_Information_v2.csv",header = TRUE)
colors <- c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#a9a9a9', '#008080', '#e6beff', '#00000f','#f00000')
output_df$MR <- as.character(as.vector(output_df$MR))
output_df$Cancer <- as.character(as.vector(output_df$Cancer))
#Get only thoe master regulators which are very significant
temp_df <- output_df[-log10(output_df$Padj)>=4.0,]
p2 <- ggplot(output_df, aes(x = NES, y = -log10(Padj),
shape = Cancer
)) +
geom_rect(data=NULL,aes(xmin=-4,xmax=0,ymin=-Inf,ymax=Inf),
fill="lightblue")+
geom_rect(data=NULL,aes(xmin=0,xmax=4,ymin=-Inf,ymax=Inf),
fill="lightred")+
geom_point()+
geom_point(data=output_df[output_df$Cancer==all_inv[1],], aes(x=NES, y=-log10(Padj), color=all_inv[1]))+
geom_point(data=output_df[output_df$Cancer==all_inv[2],], aes(x=NES, y=-log10(Padj), color=all_inv[2]))+
geom_point(data=output_df[output_df$Cancer==all_inv[3],], aes(x=NES, y=-log10(Padj), color=all_inv[3]))+
geom_point(data=output_df[output_df$Cancer==all_inv[4],], aes(x=NES, y=-log10(Padj), color=all_inv[4]))+
geom_point(data=output_df[output_df$Cancer==all_inv[5],], aes(x=NES, y=-log10(Padj), color=all_inv[5]))+
geom_point(data=output_df[output_df$Cancer==all_inv[6],], aes(x=NES, y=-log10(Padj), color=all_inv[6]))+
geom_point(data=output_df[output_df$Cancer==all_inv[7],], aes(x=NES, y=-log10(Padj), color=all_inv[7]))+
geom_point(data=output_df[output_df$Cancer==all_inv[8],], aes(x=NES, y=-log10(Padj), color=all_inv[8]))+
geom_point(data=output_df[output_df$Cancer==all_inv[9],], aes(x=NES, y=-log10(Padj), color=all_inv[9]))+
geom_point(data=output_df[output_df$Cancer==all_inv[10],], aes(x=NES, y=-log10(Padj), color=all_inv[10]))+
xlab("Normalized Enrichment Scores (NES)") + ylab("-log10(Padj)") +
scale_shape_manual(name = "Cancer", values = 1:nlevels(as.factor(output_df$Cancer))) +
scale_color_manual(name = "Cancer", values =  colors) +
geom_hline(yintercept=c(0,-log10(0.05),4),color=c("black","green","yellow")) + geom_vline(xintercept = 0) + xlim(c(-4,4)) + ylim(c(0,6)) +
theme_minimal() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
#theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),plot.background=element_rect(fill = "black"),
#      panel.background = element_rect(fill = 'black'),legend.background = element_rect(fill = "black", color = NA),
#      legend.key = element_rect(color = "gray", fill = "black"), legend.title = element_text(color = "white"), legend.text = element_text(color = "white"))+
geom_text(aes(x=NES,y=-log10(Padj),label=MR),
data=temp_df,
hjust = 0, vjust = 0, nudge_x = 0.01, angle = 45,
size = 4, check_overlap = T) +
ggtitle("Significance vs NES for Common MRs") + theme(text = element_text(size=16,color="black")) + theme(axis.text = element_text(size=14, color="black")) + theme(plot.title = element_text(hjust = 0.5,color="black")) + coord_fixed(ratio=0.7)
p2
output_df <- read.table("../Results/Paper_Text/All_TF_Activity_Information_v2.csv",header = TRUE)
colors <- c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#a9a9a9', '#008080', '#e6beff', '#00000f','#f00000')
output_df$MR <- as.character(as.vector(output_df$MR))
output_df$Cancer <- as.character(as.vector(output_df$Cancer))
#Get only thoe master regulators which are very significant
temp_df <- output_df[-log10(output_df$Padj)>=4.0,]
p2 <- ggplot(output_df, aes(x = NES, y = -log10(Padj),
shape = Cancer
)) +
geom_rect(data=NULL,aes(xmin=-4,xmax=0,ymin=-Inf,ymax=Inf),
fill="blue")+
geom_rect(data=NULL,aes(xmin=0,xmax=4,ymin=-Inf,ymax=Inf),
fill="red")+
geom_point()+
geom_point(data=output_df[output_df$Cancer==all_inv[1],], aes(x=NES, y=-log10(Padj), color=all_inv[1]))+
geom_point(data=output_df[output_df$Cancer==all_inv[2],], aes(x=NES, y=-log10(Padj), color=all_inv[2]))+
geom_point(data=output_df[output_df$Cancer==all_inv[3],], aes(x=NES, y=-log10(Padj), color=all_inv[3]))+
geom_point(data=output_df[output_df$Cancer==all_inv[4],], aes(x=NES, y=-log10(Padj), color=all_inv[4]))+
geom_point(data=output_df[output_df$Cancer==all_inv[5],], aes(x=NES, y=-log10(Padj), color=all_inv[5]))+
geom_point(data=output_df[output_df$Cancer==all_inv[6],], aes(x=NES, y=-log10(Padj), color=all_inv[6]))+
geom_point(data=output_df[output_df$Cancer==all_inv[7],], aes(x=NES, y=-log10(Padj), color=all_inv[7]))+
geom_point(data=output_df[output_df$Cancer==all_inv[8],], aes(x=NES, y=-log10(Padj), color=all_inv[8]))+
geom_point(data=output_df[output_df$Cancer==all_inv[9],], aes(x=NES, y=-log10(Padj), color=all_inv[9]))+
geom_point(data=output_df[output_df$Cancer==all_inv[10],], aes(x=NES, y=-log10(Padj), color=all_inv[10]))+
xlab("Normalized Enrichment Scores (NES)") + ylab("-log10(Padj)") +
scale_shape_manual(name = "Cancer", values = 1:nlevels(as.factor(output_df$Cancer))) +
scale_color_manual(name = "Cancer", values =  colors) +
geom_hline(yintercept=c(0,-log10(0.05),4),color=c("black","green","yellow")) + geom_vline(xintercept = 0) + xlim(c(-4,4)) + ylim(c(0,6)) +
theme_minimal() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
#theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),plot.background=element_rect(fill = "black"),
#      panel.background = element_rect(fill = 'black'),legend.background = element_rect(fill = "black", color = NA),
#      legend.key = element_rect(color = "gray", fill = "black"), legend.title = element_text(color = "white"), legend.text = element_text(color = "white"))+
geom_text(aes(x=NES,y=-log10(Padj),label=MR),
data=temp_df,
hjust = 0, vjust = 0, nudge_x = 0.01, angle = 45,
size = 4, check_overlap = T) +
ggtitle("Significance vs NES for Common MRs") + theme(text = element_text(size=16,color="black")) + theme(axis.text = element_text(size=14, color="black")) + theme(plot.title = element_text(hjust = 0.5,color="black")) + coord_fixed(ratio=0.7)
colors <- c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#a9a9a9', '#008080', '#e6beff', '#00000f','#f00000')
output_df$MR <- as.character(as.vector(output_df$MR))
output_df$Cancer <- as.character(as.vector(output_df$Cancer))
#Get only thoe master regulators which are very significant
temp_df <- output_df[-log10(output_df$Padj)>=4.0,]
p2 <- ggplot(output_df, aes(x = NES, y = -log10(Padj),
shape = Cancer
)) +
geom_rect(data=NULL,aes(xmin=-4,xmax=0,ymin=-Inf,ymax=Inf),
fill="blue")+
geom_rect(data=NULL,aes(xmin=0,xmax=4,ymin=-Inf,ymax=Inf),
fill="red")+
geom_point()+
geom_point(data=output_df[output_df$Cancer==all_inv[1],], aes(x=NES, y=-log10(Padj), color=all_inv[1]))+
geom_point(data=output_df[output_df$Cancer==all_inv[2],], aes(x=NES, y=-log10(Padj), color=all_inv[2]))+
geom_point(data=output_df[output_df$Cancer==all_inv[3],], aes(x=NES, y=-log10(Padj), color=all_inv[3]))+
geom_point(data=output_df[output_df$Cancer==all_inv[4],], aes(x=NES, y=-log10(Padj), color=all_inv[4]))+
geom_point(data=output_df[output_df$Cancer==all_inv[5],], aes(x=NES, y=-log10(Padj), color=all_inv[5]))+
geom_point(data=output_df[output_df$Cancer==all_inv[6],], aes(x=NES, y=-log10(Padj), color=all_inv[6]))+
geom_point(data=output_df[output_df$Cancer==all_inv[7],], aes(x=NES, y=-log10(Padj), color=all_inv[7]))+
geom_point(data=output_df[output_df$Cancer==all_inv[8],], aes(x=NES, y=-log10(Padj), color=all_inv[8]))+
geom_point(data=output_df[output_df$Cancer==all_inv[9],], aes(x=NES, y=-log10(Padj), color=all_inv[9]))+
geom_point(data=output_df[output_df$Cancer==all_inv[10],], aes(x=NES, y=-log10(Padj), color=all_inv[10]))+
xlab("Normalized Enrichment Scores (NES)") + ylab("-log10(Padj)") +
scale_shape_manual(name = "Cancer", values = 1:nlevels(as.factor(output_df$Cancer))) +
scale_color_manual(name = "Cancer", values =  colors) +
geom_hline(yintercept=c(0,-log10(0.05),4),color=c("white","green","yellow")) + geom_vline(xintercept = 0) + xlim(c(-4,4)) + ylim(c(0,6)) +
theme_minimal() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
#theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),plot.background=element_rect(fill = "black"),
#      panel.background = element_rect(fill = 'black'),legend.background = element_rect(fill = "black", color = NA),
#      legend.key = element_rect(color = "gray", fill = "black"), legend.title = element_text(color = "white"), legend.text = element_text(color = "white"))+
geom_text(aes(x=NES,y=-log10(Padj),label=MR),
data=temp_df,
hjust = 0, vjust = 0, nudge_x = 0.01, angle = 45,
size = 4, check_overlap = T) +
ggtitle("Significance vs NES for Common MRs") + theme(text = element_text(size=16,color="black")) + theme(axis.text = element_text(size=14, color="black")) + theme(plot.title = element_text(hjust = 0.5,color="black")) + coord_fixed(ratio=0.7)
p2
output_df <- read.table("../Results/Paper_Text/All_TF_Activity_Information_v2.csv",header = TRUE)
colors <- c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#a9a9a9', '#008080', '#e6beff', '#00000f','#f00000')
output_df$MR <- as.character(as.vector(output_df$MR))
output_df$Cancer <- as.character(as.vector(output_df$Cancer))
#Get only thoe master regulators which are very significant
temp_df <- output_df[-log10(output_df$Padj)>=4.0,]
p2 <- ggplot(output_df, aes(x = NES, y = -log10(Padj),
shape = Cancer
)) +
geom_rect(data=NULL,aes(xmin=-4,xmax=0,ymin=-Inf,ymax=Inf),
fill="blue")+
geom_rect(data=NULL,aes(xmin=0,xmax=4,ymin=-Inf,ymax=Inf),
fill="red")+
geom_point()+
geom_point(data=output_df[output_df$Cancer==all_inv[1],], aes(x=NES, y=-log10(Padj), color=all_inv[1]))+
geom_point(data=output_df[output_df$Cancer==all_inv[2],], aes(x=NES, y=-log10(Padj), color=all_inv[2]))+
geom_point(data=output_df[output_df$Cancer==all_inv[3],], aes(x=NES, y=-log10(Padj), color=all_inv[3]))+
geom_point(data=output_df[output_df$Cancer==all_inv[4],], aes(x=NES, y=-log10(Padj), color=all_inv[4]))+
geom_point(data=output_df[output_df$Cancer==all_inv[5],], aes(x=NES, y=-log10(Padj), color=all_inv[5]))+
geom_point(data=output_df[output_df$Cancer==all_inv[6],], aes(x=NES, y=-log10(Padj), color=all_inv[6]))+
geom_point(data=output_df[output_df$Cancer==all_inv[7],], aes(x=NES, y=-log10(Padj), color=all_inv[7]))+
geom_point(data=output_df[output_df$Cancer==all_inv[8],], aes(x=NES, y=-log10(Padj), color=all_inv[8]))+
geom_point(data=output_df[output_df$Cancer==all_inv[9],], aes(x=NES, y=-log10(Padj), color=all_inv[9]))+
geom_point(data=output_df[output_df$Cancer==all_inv[10],], aes(x=NES, y=-log10(Padj), color=all_inv[10]))+
xlab("Normalized Enrichment Scores (NES)") + ylab("-log10(Padj)") +
scale_shape_manual(name = "Cancer", values = 1:nlevels(as.factor(output_df$Cancer))) +
scale_color_manual(name = "Cancer", values =  colors) +
geom_hline(yintercept=c(0,-log10(0.05),4),color=c("black","green","yellow")) + geom_vline(xintercept = 0) + xlim(c(-4,4)) + ylim(c(0,6)) +
theme_minimal() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
#theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),plot.background=element_rect(fill = "black"),
#      panel.background = element_rect(fill = 'black'),legend.background = element_rect(fill = "black", color = NA),
#      legend.key = element_rect(color = "gray", fill = "black"), legend.title = element_text(color = "white"), legend.text = element_text(color = "white"))+
geom_text(aes(x=NES,y=-log10(Padj),label=MR),
data=temp_df,
hjust = 0, vjust = 0, nudge_x = 0.01, angle = 45,
size = 4, check_overlap = T) +
ggtitle("Significance vs NES for Common MRs") + theme(text = element_text(size=16,color="white")) + theme(axis.text = element_text(size=14, color="black")) + theme(plot.title = element_text(hjust = 0.5,color="black")) + coord_fixed(ratio=0.7)
ggsave(file="../Results/Paper_Figures/Figure2/Volcano_Plot_TF_Activity_3A.pdf",plot = p2, device = pdf(), width = 12, height=10, units = "in", dpi = 300)
dev.off()
p2 <- ggplot(output_df, aes(x = NES, y = -log10(Padj),
shape = Cancer
)) +
geom_rect(data=NULL,aes(xmin=-4,xmax=0,ymin=-Inf,ymax=Inf),
fill="blue")+
geom_rect(data=NULL,aes(xmin=0,xmax=4,ymin=-Inf,ymax=Inf),
fill="red")+
geom_point()+
geom_point(data=output_df[output_df$Cancer==all_inv[1],], aes(x=NES, y=-log10(Padj), color=all_inv[1]))+
geom_point(data=output_df[output_df$Cancer==all_inv[2],], aes(x=NES, y=-log10(Padj), color=all_inv[2]))+
geom_point(data=output_df[output_df$Cancer==all_inv[3],], aes(x=NES, y=-log10(Padj), color=all_inv[3]))+
geom_point(data=output_df[output_df$Cancer==all_inv[4],], aes(x=NES, y=-log10(Padj), color=all_inv[4]))+
geom_point(data=output_df[output_df$Cancer==all_inv[5],], aes(x=NES, y=-log10(Padj), color=all_inv[5]))+
geom_point(data=output_df[output_df$Cancer==all_inv[6],], aes(x=NES, y=-log10(Padj), color=all_inv[6]))+
geom_point(data=output_df[output_df$Cancer==all_inv[7],], aes(x=NES, y=-log10(Padj), color=all_inv[7]))+
geom_point(data=output_df[output_df$Cancer==all_inv[8],], aes(x=NES, y=-log10(Padj), color=all_inv[8]))+
geom_point(data=output_df[output_df$Cancer==all_inv[9],], aes(x=NES, y=-log10(Padj), color=all_inv[9]))+
geom_point(data=output_df[output_df$Cancer==all_inv[10],], aes(x=NES, y=-log10(Padj), color=all_inv[10]))+
xlab("Normalized Enrichment Scores (NES)") + ylab("-log10(Padj)") +
scale_shape_manual(name = "Cancer", values = 1:nlevels(as.factor(output_df$Cancer))) +
scale_color_manual(name = "Cancer", values =  colors) +
geom_hline(yintercept=c(0,-log10(0.05),4),color=c("black","green","yellow")) + geom_vline(xintercept = 0) + xlim(c(-4,4)) + ylim(c(0,6)) +
theme_minimal() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
#theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),plot.background=element_rect(fill = "black"),
#      panel.background = element_rect(fill = 'black'),legend.background = element_rect(fill = "black", color = NA),
#      legend.key = element_rect(color = "gray", fill = "black"), legend.title = element_text(color = "white"), legend.text = element_text(color = "white"))+
geom_text(aes(x=NES,y=-log10(Padj),label=MR),
data=temp_df,
hjust = 0, vjust = 0, nudge_x = 0.01, angle = 45,
size = 4, check_overlap = T) +
ggtitle("Significance vs NES for Common MRs") + theme(text = element_text(size=16,color="black")) + theme(axis.text = element_text(size=14, color="black")) + theme(plot.title = element_text(hjust = 0.5,color="black")) + coord_fixed(ratio=0.7)
ggsave(file="../Results/Paper_Figures/Figure3/Volcano_Plot_TF_Activity_3A.pdf",plot = p2, device = pdf(), width = 12, height=10, units = "in", dpi = 300)
dev.off()
supplementary_df <- output_df[,c(3,5,6)]
t_supp_df <- melt(supplementary_df,id.vars = "NES")
colnames(t_supp_df) <- c("NES","INV","value")
t_supp_df$"NES_Eff" <- t_supp_df$NES>0
t_supp_df$INV <- as.character(as.vector(t_supp_df$INV))
t_supp_df[t_supp_df$INV=="Median_INV_High",]$INV <- "INV High"
t_supp_df[t_supp_df$INV=="Median_INV_Low",]$INV <- "INV Low"
t_supp_df[t_supp_df$NES>0,]$"NES_Eff" <- "NES>0"
t_supp_df[t_supp_df$NES<=0,]$"NES_Eff" <- "NES<0"
t_supp_df$value <- as.numeric(as.vector(t_supp_df$value))
p_supp <- ggplot(t_supp_df, aes(x=NES_Eff,y=value, fill=INV )) + geom_boxplot(position = position_dodge(0.9), outlier.alpha = 0.1 ) +
scale_fill_manual(name="INV Phenotype" ,values = c("yellow", "green")) + xlab("Categorized NES") + ylab("Median Common MR Activities")+
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(c(-0.5,0.5)) +
ggtitle("NES based classification of Common MRs") + theme(text = element_text(size=16)) + theme(plot.title = element_text(hjust = 0.5))+
geom_text(x=1,y=0.35,label="****",col="red") + geom_text(x=2,y=0.35,label="****",col="red")
p_supp
p_supp <- ggplot(t_supp_df, aes(x=NES_Eff,y=value, fill=INV )) + geom_boxplot(position = position_dodge(0.9), outlier.alpha = 0.1 ) +
scale_fill_manual(name="INV Phenotype" ,values = c("red", "blue")) + xlab("Categorized NES") + ylab("Median Common MR Activities")+
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(c(-0.5,0.5)) +
ggtitle("NES based classification of Common MRs") + theme(text = element_text(size=16)) + theme(plot.title = element_text(hjust = 0.5))+
geom_text(x=1,y=0.35,label="****",col="red") + geom_text(x=2,y=0.35,label="****",col="red")
ggsave(file="../Results/Paper_Figures/Svgs_Jpgs/Supp_Figure_4.jpg",plot=p_supp,device=jpeg(),width=12,height=10,units="in",dpi=300)
dev.off()
p_supp
p3 <- ggplot(output_df, aes(x = Median_INV_High, y = Median_INV_Low,
shape = Cancer,
size = -log10(Padj)
)) +
geom_point()+
geom_point(data=output_df[output_df$Cancer==all_inv[1],], aes(x=Median_INV_High, y=Median_INV_Low, color=all_inv[1]))+
geom_point(data=output_df[output_df$Cancer==all_inv[2],], aes(x=Median_INV_High, y=Median_INV_Low, color=all_inv[2]))+
geom_point(data=output_df[output_df$Cancer==all_inv[3],], aes(x=Median_INV_High, y=Median_INV_Low, color=all_inv[3]))+
geom_point(data=output_df[output_df$Cancer==all_inv[4],], aes(x=Median_INV_High, y=Median_INV_Low, color=all_inv[4]))+
geom_point(data=output_df[output_df$Cancer==all_inv[5],], aes(x=Median_INV_High, y=Median_INV_Low, color=all_inv[5]))+
geom_point(data=output_df[output_df$Cancer==all_inv[6],], aes(x=Median_INV_High, y=Median_INV_Low, color=all_inv[6]))+
geom_point(data=output_df[output_df$Cancer==all_inv[7],], aes(x=Median_INV_High, y=Median_INV_Low, color=all_inv[7]))+
geom_point(data=output_df[output_df$Cancer==all_inv[8],], aes(x=Median_INV_High, y=Median_INV_Low, color=all_inv[8]))+
geom_point(data=output_df[output_df$Cancer==all_inv[9],], aes(x=Median_INV_High, y=Median_INV_Low, color=all_inv[9]))+
geom_point(data=output_df[output_df$Cancer==all_inv[10],], aes(x=Median_INV_High, y=Median_INV_Low, color=all_inv[10]))+
xlab("Median Activity in INV High samples") + ylab("Median Activity in INV Low samples") +
scale_shape_manual(name = "Cancer", values = 1:nlevels(as.factor(output_df$Cancer))) +
scale_color_manual(name = "Cancer", values =  colors) +
scale_size_continuous(range=c(0.1,3)) +
geom_hline(yintercept=0,col="black") + geom_vline(xintercept = 0,col="black") + xlim(c(-0.4,0.4)) + ylim(c(-0.4,0.4)) +
theme_minimal() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
#theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),plot.background=element_rect(fill = "black"),
#      panel.background = element_rect(fill = 'black'),legend.background = element_rect(fill = "black", color = NA),
#      legend.key = element_rect(color = "gray", fill = "black"), legend.title = element_text(color = "white"), legend.text = element_text(color = "white"))+
geom_text(aes(x=Median_INV_High,y=Median_INV_Low,label=MR),
data=temp_df,
hjust = 0, vjust = 0, nudge_x = 0.01, angle = 45,
size = 4, check_overlap = T,color="black") +
ggtitle("Median Common MR Activity for INV High vs INV Low Phenotype") + theme(text = element_text(size=16,color="black")) + theme(axis.text = element_text(size=14, color="black")) + theme(plot.title = element_text(hjust = 0.5,color="black")) + coord_fixed(ratio=0.7)
p3
ggsave(file="../Results/Paper_Figures/Figure3/Avg_TF_Activity_Figure_3B.pdf",plot = p3, device = pdf(), width = 12, height=10, units = "in", dpi = 300)
dev.off()
figure <- ggarrange(p2, p3,
labels = c("A", "B"),
ncol = 2, nrow = 1)
ggsave(filename = paste0("../Results/Paper_Figures/Figure3/Figure3_A_B.pdf"),device = pdf(), plot = figure, dpi = 300, width = 20, height=6 , units = "in" )
dev.off()
library(data.table)
library(ggplot2)
library(doMC)
library(heatmap3)
library(gplots)
library(igraph)
library(lattice)
library(parallel)
library(reshape2)
#source("https://bioconductor.org/biocLite.R")
#biocLite("fgsea")
require(fgsea)
library(fastcluster)
library(factoextra)
library(devtools)
library(imager)
library(gridExtra)
library(purrr)
library(dplyr)
library(jpeg)
library(png)
library(grid)
library(plyr)
library(RColorBrewer)
library(ggsignif)
library(gridExtra)
library(ggpubr)
library(grImport2)
library(matrixStats)
warnings("off")
source_url("https://raw.githubusercontent.com/obigriffith/biostar-tutorials/master/Heatmaps/heatmap.3.R")
registerDoMC(20)
setwd('../scripts/')
source('gene-reverse-network.R')
source('get_functions.R')
revise_wilcox_test_info <- function(wilcox_test_info)
{
wilcox_test_info$Pval <- round(wilcox_test_info$Pval,5)
wilcox_test_info$Mean1 <- round(wilcox_test_info$Mean1,3)
wilcox_test_info$Mean2 <- round(wilcox_test_info$Mean2,3)
wilcox_test_info$FC_Mean <- round(wilcox_test_info$FC_Mean,3)
return(wilcox_test_info)
}
all_inv <- c("LGG","KIRP","PAAD","MESO","KIRC",
"COAD","BLCA","STAD","LUAD","OV")
common_mrs_enabled_list <- NULL
common_mrs_all_list <- NULL
output_df <- read.table("../Results/Paper_Text/All_TF_Activity_Information_v2.csv",header = TRUE)
output_df$MR <- as.character(as.vector(output_df$MR))
output_df$Cancer <- as.character(as.vector(output_df$Cancer))
colors <- c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#a9a9a9', '#008080', '#e6beff', '#00000f','#f00000')
common_mrs_all_list <- c(output_df[output_df$Cancer==all_inv[1],]$MR)
for (i in 2:length(INV_enabled))
{
new_mrs <- output_df[output_df$Cancer==all_inv[i],]$MR
common_mrs_all_list <- intersect(common_mrs_all_list,new_mrs)
}
common_mrs_all_list <- c(output_df[output_df$Cancer==all_inv[1],]$MR)
for (i in 2:length(all_inv))
{
new_mrs <- output_df[output_df$Cancer==all_inv[i],]$MR
common_mrs_all_list <- intersect(common_mrs_all_list,new_mrs)
}
common_mrs_all_list <- c(output_df[output_df$Cancer==all_inv[1],]$MR)
for (i in 2:length(all_inv))
{
new_mrs <- output_df[output_df$Cancer==all_inv[i],]$MR
common_mrs_all_list <- intersect(common_mrs_all_list,new_mrs)
}
common_mrs_all_activity_matrix <- matrix(0,nrow=length(common_mrs_all_list),ncol=2*length(all_inv))
common_mrs_all_list <- sort(common_mrs_all_list)
rownames(common_mrs_all_activity_matrix) <- common_mrs_all_list
colnames(common_mrs_all_activity_matrix) <- c(all_inv, all_inv)
common_mrs_all_list <- c(output_df[output_df$Cancer==all_inv[1],]$MR)
for (i in 2:length(all_inv))
{
new_mrs <- output_df[output_df$Cancer==all_inv[i],]$MR
common_mrs_all_list <- intersect(common_mrs_all_list,new_mrs)
}
common_mrs_all_activity_matrix <- matrix(0,nrow=length(common_mrs_all_list),ncol=2*length(all_inv))
common_mrs_all_list <- sort(common_mrs_all_list)
rownames(common_mrs_all_activity_matrix) <- common_mrs_all_list
colnames(common_mrs_all_activity_matrix) <- c(all_inv, all_inv)
for (i in 1:length(all_inv))
{
cancer <- all_inv[i]
temp_df <- output_df[output_df$MR %in% common_mrs_all_list & output_df$Cancer==cancer,]
temp_df <- temp_df[order(temp_df$MR),]
inv_high <- temp_df$Median_INV_High
inv_low <- temp_df$Median_INV_Low
common_mrs_all_activity_matrix[common_mrs_all_list,i] <- inv_high
common_mrs_all_activity_matrix[common_mrs_all_list,(i+length(all_inv))] <- inv_low
}
colcol <- matrix(0,nrow=2*length(all_inv),ncol=1)
colcol[c(1:length(all_inv)),1] <- "red"
colcol[c((length(all_inv)+1):(2*length(all_inv))),1] <- "blue"
heatmap.3(common_mrs_all_activity_matrix, Rowv = TRUE, Colv=TRUE, col = bluered(100), scale="none", main= "Median Activity of MRs common across all Invasive Cancers",
labRow = rownames(common_mrs_all_activity_matrix), labCol = colnames(common_mrs_all_activity_matrix), dendrogram = "col",
key = TRUE, density.info = "none", KeyValueName = "Activity Value", ColSideColors = colcol, ColSideColorsSize = 2,
margins = c(6,6), useRaster = FALSE, cexRow = 1.25, cexCol = 2, cellnote = ifelse(common_mrs_all_activity_matrix>0,"+","-"), notecex = 2, notecol = "black")
pdf("../Results/Paper_Figures/Figure3/Common_TopMRs_Activity_INV_Figure_3C.pdf",height = 10, width=12, pointsize = 14)
heatmap.3(common_mrs_all_activity_matrix, Rowv = TRUE, Colv=TRUE, col = bluered(100), scale="none", main= "Median Activity of MRs common across all Invasive Cancers",
labRow = rownames(common_mrs_all_activity_matrix), labCol = colnames(common_mrs_all_activity_matrix), dendrogram = "col",
key = TRUE, density.info = "none", KeyValueName = "Activity Value", ColSideColors = colcol, ColSideColorsSize = 2,
margins = c(6,6), useRaster = FALSE, cexRow = 1.25, cexCol = 2, cellnote = ifelse(common_mrs_all_activity_matrix>0,"+","-"), notecex = 2, notecol = "black")
dev.off()
A <- common_mrs_all_activity_matrix[common_mrs_all_list,c(1:length(all_inv))];
B <- common_mrs_all_activity_matrix[common_mrs_all_list,c((length(all_inv)+1):(2*length(all_inv)))]
wilcox_test_info <- perform_wilcox_test(A,B)
wilcox_test_info <- wilcox_test_info[order(wilcox_test_info$FC_Mean,decreasing=TRUE),]
wilcox_test_info <- revise_wilcox_test_info(wilcox_test_info)
write.table(wilcox_test_info,"../Results/Paper_Text/Supplementary_Table_S1_Common_MRs_INV_Enabled.csv",row.names=T,col.names=T,quote=F)
top_10_common_mrs_enabled <- rownames(wilcox_test_info)[1:10]
top_10_common_mrs_enabled
write.table(wilcox_test_info,"../Results/Paper_Text/Supplementary_Table_S1_Common_MRs_INV.csv",row.names=T,col.names=T,quote=F)
inv_activity_df <- as.data.frame(inv_activity_df)
colnames(inv_activity_df) <- c("Cancer","TopMR","Phenotype","Activity_Value")
inv_activity_df$Cancer <- as.character(as.vector(inv_activity_df$Cancer))
inv_activity_df$TopMR <- as.character(as.vector(inv_activity_df$TopMR))
inv_activity_df$Phenotype <- as.character(as.vector(inv_activity_df$Phenotype))
inv_activity_df$Activity_Value <- as.numeric(as.vector(inv_activity_df$Activity_Value))
inv_activity_df <- NULL
for (cancer in all_inv)
{
load(paste0("../Results/",cancer,"/Adjacency_Matrix/",cancer,"_Full_Activity_matrix_FGSEA.Rdata"))
amat[amat>0] <- amat[amat>0]/max(amat)
amat[amat<0] <- amat[amat<0]/abs(min(amat))
#Load mechanistic network
#======================================================================================
load('../Data/Others/me_net_full.Rdata')
#Get the data
filename = cancer
out <- loading_data(filename,M)
D <- as.matrix(log2(t(out[[1]])+1))
#Get high and low indices
load(paste0("../Data/",filename,"/",filename,"_INV_cluster_assignment_k2-6_v2.Rdata"))
high_low_output <- get_high_low_indices(table_cluster_assignment,D)
table_cluster_assignment <- high_low_output[[1]]
high_indices <- high_low_output[[2]]
low_indices <- high_low_output[[3]]
for (topmr in top_10_common_mrs_enabled)
{
high_activity <- amat[topmr,high_indices]
low_activity <- amat[topmr,low_indices]
enabled_activity_df <- rbind(enabled_activity_df,
cbind(rep(cancer,length(high_activity)+length(low_activity)),
rep(topmr,length(high_activity)+length(low_activity)),
c(rep("INV High",length(high_activity)),rep("INV Low",length(low_activity))),
c(high_activity,low_activity)))
}
}
inv_activity_df <- as.data.frame(inv_activity_df)
colnames(inv_activity_df) <- c("Cancer","TopMR","Phenotype","Activity_Value")
inv_activity_df$Cancer <- as.character(as.vector(inv_activity_df$Cancer))
inv_activity_df$TopMR <- as.character(as.vector(inv_activity_df$TopMR))
inv_activity_df$Phenotype <- as.character(as.vector(inv_activity_df$Phenotype))
inv_activity_df$Activity_Value <- as.numeric(as.vector(inv_activity_df$Activity_Value))
inv_activity_df <- NULL
for (cancer in all_inv)
{
load(paste0("../Results/",cancer,"/Adjacency_Matrix/",cancer,"_Full_Activity_matrix_FGSEA.Rdata"))
amat[amat>0] <- amat[amat>0]/max(amat)
amat[amat<0] <- amat[amat<0]/abs(min(amat))
#Load mechanistic network
#======================================================================================
load('../Data/Others/me_net_full.Rdata')
#Get the data
filename = cancer
out <- loading_data(filename,M)
D <- as.matrix(log2(t(out[[1]])+1))
#Get high and low indices
load(paste0("../Data/",filename,"/",filename,"_INV_cluster_assignment_k2-6_v2.Rdata"))
high_low_output <- get_high_low_indices(table_cluster_assignment,D)
table_cluster_assignment <- high_low_output[[1]]
high_indices <- high_low_output[[2]]
low_indices <- high_low_output[[3]]
for (topmr in common_mrs_all_list)
{
high_activity <- amat[topmr,high_indices]
low_activity <- amat[topmr,low_indices]
inv_activity_df <- rbind(inv_activity_df,
cbind(rep(cancer,length(high_activity)+length(low_activity)),
rep(topmr,length(high_activity)+length(low_activity)),
c(rep("INV High",length(high_activity)),rep("INV Low",length(low_activity))),
c(high_activity,low_activity)))
}
}
inv_activity_df <- as.data.frame(inv_activity_df)
colnames(inv_activity_df) <- c("Cancer","TopMR","Phenotype","Activity_Value")
inv_activity_df$Cancer <- as.character(as.vector(inv_activity_df$Cancer))
inv_activity_df$TopMR <- as.character(as.vector(inv_activity_df$TopMR))
inv_activity_df$Phenotype <- as.character(as.vector(inv_activity_df$Phenotype))
inv_activity_df$Activity_Value <- as.numeric(as.vector(inv_activity_df$Activity_Value))
p3 <- ggplot(data = inv_activity_df, aes(x=TopMR, y=Activity_Value)) +
geom_boxplot(aes(fill=Phenotype)) + facet_wrap( ~ Cancer, nrow=1, ncol=6) + xlab("Top Common MRs") + ylab("Activity Value") +
geom_point(aes(y=Activity_Value, group=Phenotype), size=0.01, position = position_dodge(width=0.75))+
guides(fill=guide_legend(title="Phenotype")) + scale_fill_manual(values=c("red","blue")) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(axis.text.x = element_text(angle = -90)) +
ggtitle("Activities of Common MRs common across Invasive Cancers ") + theme(text = element_text(size=12)) + theme(plot.title = element_text(hjust = 0.5))
p3
inv_activity_df
inv_activity_df$TopMR
unique(inv_activity_df$TopMR)
p3 <- ggplot(data = inv_activity_df, aes(x=TopMR, y=Activity_Value)) +
geom_boxplot(aes(fill=Phenotype)) + facet_wrap( ~ Cancer, nrow=2, ncol=3) + xlab("Top Common MRs") + ylab("Activity Value") +
geom_point(aes(y=Activity_Value, group=Phenotype), size=0.01, position = position_dodge(width=0.75))+
guides(fill=guide_legend(title="Phenotype")) + scale_fill_manual(values=c("red","blue")) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(axis.text.x = element_text(angle = -90)) +
ggtitle("Activities of Common MRs common across Invasive Cancers ") + theme(text = element_text(size=12)) + theme(plot.title = element_text(hjust = 0.5))
p3
p3 <- ggplot(data = inv_activity_df, aes(x=TopMR, y=Activity_Value)) +
geom_boxplot(aes(fill=Phenotype)) + facet_wrap( ~ Cancer, nrow=2, ncol=5) + xlab("Top Common MRs") + ylab("Activity Value") +
geom_point(aes(y=Activity_Value, group=Phenotype), size=0.01, position = position_dodge(width=0.75))+
guides(fill=guide_legend(title="Phenotype")) + scale_fill_manual(values=c("red","blue")) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(axis.text.x = element_text(angle = -90)) +
ggtitle("Activities of Common MRs common across Invasive Cancers ") + theme(text = element_text(size=12)) + theme(plot.title = element_text(hjust = 0.5))
p3
ggsave(file="../Results/Paper_Figures/Figure3/Common_TopMRs_Activity_Figure_3D.pdf",plot = p3, device = pdf(), width = 12, height=12, units = "in", dpi = 300)
dev.off()
