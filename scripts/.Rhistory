}
all_inv <- c("LGG","KIRP","PAAD","MESO","KIRC",
"COAD","BLCA","STAD","LUAD","OV")
common_mrs_all_list <- NULL
output_df <- read.table("../Results/Paper_Text/All_TF_Activity_Information_v2.csv",header = TRUE)
output_df$MR <- as.character(as.vector(output_df$MR))
output_df$Cancer <- as.character(as.vector(output_df$Cancer))
colors <- c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#a9a9a9', '#008080', '#e6beff', '#00000f','#f00000')
common_mrs_all_list <- c(output_df[output_df$Cancer==all_inv[1],]$MR)
for (i in 2:length(all_inv))
{
new_mrs <- output_df[output_df$Cancer==all_inv[i],]$MR
common_mrs_all_list <- intersect(common_mrs_all_list,new_mrs)
}
debugSource("~/Documents/Misc_Work/Other Work/INV_Analysis/scripts/figure3ab.R")
output_df
library(data.table)
library(ggplot2)
library(doMC)
library(heatmap3)
library(gplots)
library(igraph)
library(lattice)
library(parallel)
library(reshape2)
#source("https://bioconductor.org/biocLite.R")
#biocLite("fgsea")
require(fgsea)
library(fastcluster)
library(factoextra)
library(devtools)
library(imager)
library(gridExtra)
library(purrr)
library(dplyr)
library(jpeg)
library(png)
library(grid)
library(plyr)
library(RColorBrewer)
library(ggsignif)
library(gridExtra)
library(ggpubr)
library(grImport2)
library(matrixStats)
warnings("off")
source_url("https://raw.githubusercontent.com/obigriffith/biostar-tutorials/master/Heatmaps/heatmap.3.R")
registerDoMC(20)
setwd('../scripts/')
source('gene-reverse-network.R')
source('get_functions.R')
revise_wilcox_test_info <- function(wilcox_test_info)
{
wilcox_test_info$Pval <- round(wilcox_test_info$Pval,5)
wilcox_test_info$Mean1 <- round(wilcox_test_info$Mean1,3)
wilcox_test_info$Mean2 <- round(wilcox_test_info$Mean2,3)
wilcox_test_info$FC_Mean <- round(wilcox_test_info$FC_Mean,3)
return(wilcox_test_info)
}
all_inv <- c("LGG","KIRP","PAAD","MESO","KIRC",
"COAD","BLCA","STAD","LUAD","OV")
common_mrs_all_list <- NULL
output_df <- read.table("../Results/Paper_Text/All_TF_Activity_Information_v2.csv",header = TRUE)
output_df$MR <- as.character(as.vector(output_df$MR))
output_df$Cancer <- as.character(as.vector(output_df$Cancer))
colors <- c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#a9a9a9', '#008080', '#e6beff', '#00000f','#f00000')
common_mrs_all_list <- c(output_df[output_df$Cancer==all_inv[1],]$MR)
for (i in 2:length(all_inv))
{
new_mrs <- output_df[output_df$Cancer==all_inv[i],]$MR
common_mrs_all_list <- intersect(common_mrs_all_list,new_mrs)
}
common_mrs_all_list
library(data.table)
library(ggplot2)
library(doMC)
library(heatmap3)
library(gplots)
library(igraph)
library(lattice)
library(parallel)
library(reshape2)
require(fgsea)
library(ComplexHeatmap)
library(fastcluster)
library(factoextra)
library(devtools)
library(imager)
library(gridExtra)
library(purrr)
library(dplyr)
library(jpeg)
library(png)
library(grid)
library(plyr)
library(RColorBrewer)
library(ggsignif)
library(plotly)
library(processx)
library(ggpubr)
library(grImport2)
#library(clusterProfiler)
library(magrittr)
library(msigdbr)
library(networkD3)
library(matrixStats)
library(rbokeh)
warnings("off")
source_url("https://raw.githubusercontent.com/obigriffith/biostar-tutorials/master/Heatmaps/heatmap.3.R")
registerDoMC(20)
setwd('../scripts/')
source('gene-reverse-network.R')
source('get_functions.R')
get_tf_median_activity <- function(cancer)
{
#Load mechanistic network
#======================================================================================
load('../Data/Others/me_net_full.Rdata')
#Get the data
filename = cancer
out <- loading_data(filename,M)
D <- as.matrix(log2(t(out[[1]])+1))
#Get high and low indices
load(paste0("../Data/",filename,"/",filename,"_INV_cluster_assignment_k2-6_v2.Rdata"))
high_low_output <- get_high_low_indices(table_cluster_assignment,D)
table_cluster_assignment <- high_low_output[[1]]
high_indices <- high_low_output[[2]]
low_indices <- high_low_output[[3]]
load(paste0("../Results/",cancer,"/Adjacency_Matrix/",cancer,"_Full_Activity_matrix_FGSEA.Rdata"))
amat[amat>0] <- amat[amat>0]/max(amat)
amat[amat<0] <- amat[amat<0]/abs(min(amat))
tfs_median_high_activity <- rowMedians(amat[,high_indices])
tfs_median_low_activity <- rowMedians(amat[,low_indices])
activity_info <- cbind(rownames(amat),rep(cancer,nrow(amat)),tfs_median_high_activity,tfs_median_low_activity)
return(activity_info)
}
get_tf_activity_high_low <- function(cancer,tf)
{
load(paste0("../Results/",cancer,"/Adjacency_Matrix/",cancer,"_Full_Activity_matrix_FGSEA.Rdata"))
amat[amat>0] <- amat[amat>0]/max(amat)
amat[amat<0] <- amat[amat<0]/abs(min(amat))
#Load mechanistic network
#======================================================================================
load('../Data/Others/me_net_full.Rdata')
#Get the data
filename = cancer
out <- loading_data(filename,M)
D <- as.matrix(log2(t(out[[1]])+1))
#Get high and low indices
load(paste0("../Data/",filename,"/",filename,"_INV_cluster_assignment_k2-6_v2.Rdata"))
high_low_output <- get_high_low_indices(table_cluster_assignment,D)
table_cluster_assignment <- high_low_output[[1]]
high_indices <- high_low_output[[2]]
low_indices <- high_low_output[[3]]
if (tf %in% rownames(amat))
{
tf_high_activity <- as.numeric(as.vector(amat[tf,high_indices]))
tf_low_activity <- as.numeric(as.vector(amat[tf,low_indices]))
}
else{
tf_high_activity <- rep(0,length(high_indices))
tf_low_activity <- rep(0,length(low_indices))
}
return(list(tf_high_activity,tf_low_activity))
}
get_common_mrs <- function(cancer)
{
load(paste0("../Results/",cancer,"/Adjacency_Matrix/",cancer,"_Full_TopMR_Info_FGSEA_BC_NES_1.Rdata"))
load(paste0("../Results/",cancer,"/Combined/",cancer,"_Common_TopMRs.Rdata"))
common_topmr <- topmr_info[topmr_info$pathway %in% common_mrs,]$pathway
list_common_mrs <- as.character(as.vector(common_topmr));
return(list_common_mrs)
}
INV_enabled <- c("LGG","KIRP","PAAD","MESO","KIRC",
"COAD","BLCA","STAD","LUAD","OV")
tfs_enabled_activity_info <- NULL
colors <- c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#a9a9a9', '#008080', '#e6beff', '#00000f','#f00000')
first_cancer <- INV_enabled[1];
tfs_enabled_activity_info <- get_tf_median_activity(first_cancer)
for (i in 2:length(INV_enabled))
{
cancer <- INV_enabled[i]
temp <- get_tf_median_activity(cancer)
tfs_enabled_activity_info <- rbind(tfs_enabled_activity_info,temp)
}
tfs_enabled_activity_info <- as.data.frame(tfs_enabled_activity_info)
colnames(tfs_enabled_activity_info) <- c("TFs","Cancer","Median_INV_High","Median_INV_Low")
tfs_enabled_activity_info$TFs <- as.character(as.vector(tfs_enabled_activity_info$TFs))
tfs_enabled_activity_info$Cancer <- as.character(as.vector(tfs_enabled_activity_info$Cancer))
tfs_enabled_activity_info$Median_INV_High <- as.numeric(as.vector(tfs_enabled_activity_info$Median_INV_High))
tfs_enabled_activity_info$Median_INV_Low <- as.numeric(as.vector(tfs_enabled_activity_info$Median_INV_Low))
common_tfs_enabled_list <- names(which(table(tfs_enabled_activity_info$TFs)>=10))
common_tfs_enabled_activity_info <- tfs_enabled_activity_info[tfs_enabled_activity_info$TFs %in% common_tfs_enabled_list,]
#Make a list of how many times does a common MR appear for the INV Enabled cancers
first_cancer <- INV_enabled[1];
list_common_mrs_enabled <- get_common_mrs(first_cancer)
topMRs_enabled <- rep(list("LGG"),length(list_common_mrs_enabled))
names(topMRs_enabled) <- list_common_mrs_enabled
for(i in 2:length(INV_enabled))
{
cancer_type <- INV_enabled[i]
list_common_mrs_enabled <- get_common_mrs(cancer_type)
for (j in 1:length(list_common_mrs_enabled))
{
if (list_common_mrs_enabled[j] %in% names(topMRs_enabled))
{
topMRs_enabled[[list_common_mrs_enabled[j]]] <- c(topMRs_enabled[[list_common_mrs_enabled[j]]],cancer_type)
} else {
topMRs_enabled[[list_common_mrs_enabled[j]]] <- cancer_type
}
}
}
all_inv_cancers <- unlist(lapply(topMRs_enabled,function(x) paste(x,collapse=" ")))
no_inv_cancers <- unlist(lapply(topMRs_enabled,function(x) length(x)))
enabled_df <- cbind(names(all_inv_cancers),as.character(all_inv_cancers),as.numeric(no_inv_cancers))
enabled_df <- as.data.frame(enabled_df)
colnames(enabled_df) <- c("MR","List_INV_Cancers","No_INV_Cancers")
enabled_df$MR <- as.character(as.vector(enabled_df$MR))
enabled_df$List_INV_Cancers <- as.character(as.vector(enabled_df$List_INV_Cancers))
enabled_df$No_INV_Cancers <- as.character(as.vector(enabled_df$No_INV_Cancers))
enabled_df <- enabled_df[order(enabled_df$No_INV_Cancers,decreasing=T),]
temp_enabled_df <- enabled_df[enabled_df$No_INV_Cancers>=5,]
temp_enabled_df <- temp_enabled_df[temp_enabled_df$MR %in% common_tfs_enabled_list, ]
write.table(temp_enabled_df,"../Results/Paper_Text/All_MRs_TFs_INV_Enabled_Supplementary_Table_S3.csv",row.names=F,col.names=T,quote=F,sep=",")
write.table(temp_enabled_df,"../Results/Paper_Text/All_MRs_TFs_INV_Enabled_Supplementary_Table_S2.csv",row.names=F,col.names=T,quote=F,sep=",")
write.table(temp_enabled_df,"../Results/Paper_Text/All_MRs_TFs_INV_supplementary_Table_S3.csv",row.names=F,col.names=T,quote=F,sep=",")
write.table(temp_enabled_df,"../Results/Paper_Text/All_MRs_TFs_INV_Supplementary_Table_S3.csv",row.names=F,col.names=T,quote=F,sep=",")
#Get list of common MRs which are all TFs in 5 out of 10 cancers
#########################################################################################################################
common_mrs_enabled_list <- temp_enabled_df$MR;
common_mrs_enabled_list <- sort(common_mrs_enabled_list)
common_mrs_enabled_activity_matrix <- matrix(0,nrow=length(common_mrs_enabled_list),ncol=2*length(INV_enabled))
rownames(common_mrs_enabled_activity_matrix) <- common_mrs_enabled_list
colnames(common_mrs_enabled_activity_matrix) <- c(INV_enabled,INV_enabled)
for (i in 1:length(INV_enabled))
{
cancer <- INV_enabled[i]
temp_df <- common_tfs_enabled_activity_info[common_tfs_enabled_activity_info$TFs %in% common_mrs_enabled_list
& common_tfs_enabled_activity_info$Cancer==cancer,]
temp_df <- temp_df[order(temp_df$TFs),]
inv_high <- temp_df$Median_INV_High
inv_low <- temp_df$Median_INV_Low
common_mrs_enabled_activity_matrix[common_mrs_enabled_list,i] <- inv_high
common_mrs_enabled_activity_matrix[common_mrs_enabled_list,(i+length(INV_enabled))] <- inv_low
}
colcol <- matrix(0,nrow=2*length(INV_enabled),ncol=1)
colcol[c(1:length(INV_enabled)),1] <- "red"
colcol[c((length(INV_enabled)+1):(2*length(INV_enabled))),1] <- "blue"
output_df <- common_tfs_enabled_activity_info
nes_info <- NULL
nes_pval <- NULL
for (i in 1:length(common_mrs_enabled_list))
{
mr <- common_mrs_enabled_list[i]
print(paste0("Stuck at MR: ",mr," which is MR no: ",i))
mr_inv_high_values <- NULL
mr_inv_low_values <- NULL
for (cancer in INV_enabled)
{
mr_activity_list <- get_tf_activity_high_low(cancer,mr)
mr_inv_high_values <- c(mr_inv_high_values,mr_activity_list[[1]])
mr_inv_low_values <- c(mr_inv_low_values,mr_activity_list[[2]])
}
nes_info <- c(nes_info,median(mr_inv_high_values)-median(mr_inv_low_values))
nes_pval <- c(nes_pval,wilcox.test(mr_inv_high_values,mr_inv_low_values,exact=F)$p.value)
}
inv_enabled_median_comparison <- cbind(common_mrs_enabled_list,nes_info,nes_pval)
inv_enabled_median_comparison <- as.data.frame(inv_enabled_median_comparison)
colnames(inv_enabled_median_comparison) <- c("MR","FC_Median","Pval")
inv_enabled_median_comparison$MR <- as.character(as.vector(inv_enabled_median_comparison$MR))
inv_enabled_median_comparison$FC_Median <- round(as.numeric(as.vector(inv_enabled_median_comparison$FC_Median)),3)
inv_enabled_median_comparison$Pval <- p.adjust(as.numeric(as.vector(inv_enabled_median_comparison$Pval)),method = "fdr")
final_common_mrs_enabled_list <- inv_enabled_median_comparison[inv_enabled_median_comparison$Pval<=0.05,]$MR
temp_enabled_df <- enabled_df[enabled_df$No_INV_Cancers>5,]
temp_enabled_df <- temp_enabled_df[temp_enabled_df$MR %in% common_tfs_enabled_list, ]
temp_enabled_df <- enabled_df[enabled_df$No_INV_Cancers>5,]
temp_enabled_df <- temp_enabled_df[temp_enabled_df$MR %in% common_tfs_enabled_list, ]
write.table(temp_enabled_df,"../Results/Paper_Text/All_MRs_TFs_INV_Supplementary_Table_S3.csv",row.names=F,col.names=T,quote=F,sep=",")
temp_enabled_df <- enabled_df[enabled_df$No_INV_Cancers>=5,]
temp_enabled_df <- temp_enabled_df[temp_enabled_df$MR %in% common_tfs_enabled_list, ]
write.table(temp_enabled_df,"../Results/Paper_Text/All_MRs_TFs_INV_Supplementary_Table_S3.csv",row.names=F,col.names=T,quote=F,sep=",")
common_mrs_enabled_list <- temp_enabled_df$MR;
common_mrs_enabled_list <- sort(common_mrs_enabled_list)
common_mrs_enabled_activity_matrix <- matrix(0,nrow=length(common_mrs_enabled_list),ncol=2*length(INV_enabled))
rownames(common_mrs_enabled_activity_matrix) <- common_mrs_enabled_list
colnames(common_mrs_enabled_activity_matrix) <- c(INV_enabled,INV_enabled)
for (i in 1:length(INV_enabled))
{
cancer <- INV_enabled[i]
temp_df <- common_tfs_enabled_activity_info[common_tfs_enabled_activity_info$TFs %in% common_mrs_enabled_list
& common_tfs_enabled_activity_info$Cancer==cancer,]
temp_df <- temp_df[order(temp_df$TFs),]
inv_high <- temp_df$Median_INV_High
inv_low <- temp_df$Median_INV_Low
common_mrs_enabled_activity_matrix[common_mrs_enabled_list,i] <- inv_high
common_mrs_enabled_activity_matrix[common_mrs_enabled_list,(i+length(INV_enabled))] <- inv_low
}
colcol <- matrix(0,nrow=2*length(INV_enabled),ncol=1)
colcol[c(1:length(INV_enabled)),1] <- "red"
colcol[c((length(INV_enabled)+1):(2*length(INV_enabled))),1] <- "blue"
output_df <- common_tfs_enabled_activity_info
nes_info <- NULL
nes_pval <- NULL
for (i in 1:length(common_mrs_enabled_list))
{
mr <- common_mrs_enabled_list[i]
print(paste0("Stuck at MR: ",mr," which is MR no: ",i))
mr_inv_high_values <- NULL
mr_inv_low_values <- NULL
for (cancer in INV_enabled)
{
mr_activity_list <- get_tf_activity_high_low(cancer,mr)
mr_inv_high_values <- c(mr_inv_high_values,mr_activity_list[[1]])
mr_inv_low_values <- c(mr_inv_low_values,mr_activity_list[[2]])
}
nes_info <- c(nes_info,median(mr_inv_high_values)-median(mr_inv_low_values))
nes_pval <- c(nes_pval,wilcox.test(mr_inv_high_values,mr_inv_low_values,exact=F)$p.value)
}
inv_enabled_median_comparison <- cbind(common_mrs_enabled_list,nes_info,nes_pval)
inv_enabled_median_comparison <- as.data.frame(inv_enabled_median_comparison)
colnames(inv_enabled_median_comparison) <- c("MR","FC_Median","Pval")
inv_enabled_median_comparison$MR <- as.character(as.vector(inv_enabled_median_comparison$MR))
inv_enabled_median_comparison$FC_Median <- round(as.numeric(as.vector(inv_enabled_median_comparison$FC_Median)),3)
inv_enabled_median_comparison$Pval <- p.adjust(as.numeric(as.vector(inv_enabled_median_comparison$Pval)),method = "fdr")
final_common_mrs_enabled_list <- inv_enabled_median_comparison[inv_enabled_median_comparison$Pval<=0.05,]$MR
final_common_mrs_enabled_activity_matrix <- common_mrs_enabled_activity_matrix[final_common_mrs_enabled_list,]
common_mrs_enabled_list
temp_enabled_df <- enabled_df[enabled_df$No_INV_Cancers>5,]
temp_enabled_df <- temp_enabled_df[temp_enabled_df$MR %in% common_tfs_enabled_list, ]
write.table(temp_enabled_df,"../Results/Paper_Text/All_MRs_TFs_INV_Supplementary_Table_S3.csv",row.names=F,col.names=T,quote=F,sep=",")
common_mrs_enabled_list <- temp_enabled_df$MR;
common_mrs_enabled_list <- sort(common_mrs_enabled_list)
common_mrs_enabled_activity_matrix <- matrix(0,nrow=length(common_mrs_enabled_list),ncol=2*length(INV_enabled))
rownames(common_mrs_enabled_activity_matrix) <- common_mrs_enabled_list
colnames(common_mrs_enabled_activity_matrix) <- c(INV_enabled,INV_enabled)
for (i in 1:length(INV_enabled))
{
cancer <- INV_enabled[i]
temp_df <- common_tfs_enabled_activity_info[common_tfs_enabled_activity_info$TFs %in% common_mrs_enabled_list
& common_tfs_enabled_activity_info$Cancer==cancer,]
temp_df <- temp_df[order(temp_df$TFs),]
inv_high <- temp_df$Median_INV_High
inv_low <- temp_df$Median_INV_Low
common_mrs_enabled_activity_matrix[common_mrs_enabled_list,i] <- inv_high
common_mrs_enabled_activity_matrix[common_mrs_enabled_list,(i+length(INV_enabled))] <- inv_low
}
colcol <- matrix(0,nrow=2*length(INV_enabled),ncol=1)
colcol[c(1:length(INV_enabled)),1] <- "red"
colcol[c((length(INV_enabled)+1):(2*length(INV_enabled))),1] <- "blue"
output_df <- common_tfs_enabled_activity_info
nes_info <- NULL
nes_pval <- NULL
for (i in 1:length(common_mrs_enabled_list))
{
mr <- common_mrs_enabled_list[i]
print(paste0("Stuck at MR: ",mr," which is MR no: ",i))
mr_inv_high_values <- NULL
mr_inv_low_values <- NULL
for (cancer in INV_enabled)
{
mr_activity_list <- get_tf_activity_high_low(cancer,mr)
mr_inv_high_values <- c(mr_inv_high_values,mr_activity_list[[1]])
mr_inv_low_values <- c(mr_inv_low_values,mr_activity_list[[2]])
}
nes_info <- c(nes_info,median(mr_inv_high_values)-median(mr_inv_low_values))
nes_pval <- c(nes_pval,wilcox.test(mr_inv_high_values,mr_inv_low_values,exact=F)$p.value)
}
inv_enabled_median_comparison <- cbind(common_mrs_enabled_list,nes_info,nes_pval)
inv_enabled_median_comparison <- as.data.frame(inv_enabled_median_comparison)
colnames(inv_enabled_median_comparison) <- c("MR","FC_Median","Pval")
inv_enabled_median_comparison$MR <- as.character(as.vector(inv_enabled_median_comparison$MR))
inv_enabled_median_comparison$FC_Median <- round(as.numeric(as.vector(inv_enabled_median_comparison$FC_Median)),3)
inv_enabled_median_comparison$Pval <- p.adjust(as.numeric(as.vector(inv_enabled_median_comparison$Pval)),method = "fdr")
final_common_mrs_enabled_list <- inv_enabled_median_comparison[inv_enabled_median_comparison$Pval<=0.05,]$MR
final_common_mrs_enabled_activity_matrix <- common_mrs_enabled_activity_matrix[final_common_mrs_enabled_list,]
par(bg="white")
par(fg="black",col.axis="black",col.main="black",col.lab="black", cex.main=1.75)
p1 <- heatmap.3(final_common_mrs_enabled_activity_matrix, Rowv = TRUE, Colv=, col = bluered(100), scale="none", main= "Median Activity of Common MRs in INV Enabled Cancers", # (>=4 out of 8)",
dendrogram = "both", key = TRUE, density.info = "none", KeyValueName = "Activity Value", ColSideColors = colcol, ColSideColorsSize = 2,
margins = c(6,6), useRaster = FALSE, cexRow = 0.6, cexCol = 2.0, cellnote = ifelse(final_common_mrs_enabled_activity_matrix>0,"+","-"), notecex = 1, notecol = "black")
par(bg="white")
par(fg="black",col.axis="black",col.main="black",col.lab="black", cex.main=1.75)
p1 <- heatmap.3(final_common_mrs_enabled_activity_matrix, Rowv = TRUE, Colv=, col = bluered(100), scale="none", main= "Median Activity of Common MRs in INV Enabled Cancers", # (>=4 out of 8)",
dendrogram = "both", key = TRUE, density.info = "none", KeyValueName = "Activity Value", ColSideColors = colcol, ColSideColorsSize = 2,
margins = c(6,6), useRaster = FALSE, cexRow = 0.6, cexCol = 5.0, cellnote = ifelse(final_common_mrs_enabled_activity_matrix>0,"+","-"), notecex = 1, notecol = "black")
par(bg="white")
par(fg="black",col.axis="black",col.main="black",col.lab="black", cex.main=2)
p1 <- heatmap.3(final_common_mrs_enabled_activity_matrix, Rowv = TRUE, Colv=, col = bluered(100), scale="none", main= "Median Activity of Common MRs in INV Enabled Cancers", # (>=4 out of 8)",
dendrogram = "both", key = TRUE, density.info = "none", KeyValueName = "Activity Value", ColSideColors = colcol, ColSideColorsSize = 2,
margins = c(6,6), useRaster = FALSE, cexRow = 0.6, cexCol = 1.0, cellnote = ifelse(final_common_mrs_enabled_activity_matrix>0,"+","-"), notecex = 1, notecol = "black")
par(bg="white")
par(fg="black",col.axis="black",col.main="black",col.lab="black", cex.main=1.5)
p1 <- heatmap.3(final_common_mrs_enabled_activity_matrix, Rowv = TRUE, Colv=, col = bluered(100), scale="none", main= "Median Activity of Common MRs in INV Enabled Cancers", # (>=4 out of 8)",
dendrogram = "both", key = TRUE, density.info = "none", KeyValueName = "Activity Value", ColSideColors = colcol, ColSideColorsSize = 2,
margins = c(6,6), useRaster = FALSE, cexRow = 1.0, cexCol = 1.5, cellnote = ifelse(final_common_mrs_enabled_activity_matrix>0,"+","-"), notecex = 1, notecol = "black")
pdf("../Results/Paper_Figures/Figure4/Common_TopMRs_Activity_INV_Figure_4A.pdf",height = 12, width=14, pointsize = 14)
par(bg="white")
par(fg="black",col.axis="black",col.main="black",col.lab="black", cex.main=1.5)
p1 <- heatmap.3(final_common_mrs_enabled_activity_matrix, Rowv = TRUE, Colv=, col = bluered(100), scale="none", main= "Median Activity of Common MRs in INV Enabled Cancers", # (>=4 out of 8)",
dendrogram = "both", key = TRUE, density.info = "none", KeyValueName = "Activity Value", ColSideColors = colcol, ColSideColorsSize = 2,
margins = c(6,6), useRaster = FALSE, cexRow = 1.0, cexCol = 1.5, cellnote = ifelse(final_common_mrs_enabled_activity_matrix>0,"+","-"), notecex = 1, notecol = "black")
dev.off()
pdf("../Results/Paper_Figures/Figure4/Common_TopMRs_Activity_INV_Figure_4A.pdf",height = 12, width=14, pointsize = 11)
par(bg="white")
par(fg="black",col.axis="black",col.main="black",col.lab="black", cex.main=1.5)
p1 <- heatmap.3(final_common_mrs_enabled_activity_matrix, Rowv = TRUE, Colv=, col = bluered(100), scale="none", main= "Median Activity of Common MRs in INV Enabled Cancers", # (>=4 out of 8)",
dendrogram = "both", key = TRUE, density.info = "none", KeyValueName = "Activity Value", ColSideColors = colcol, ColSideColorsSize = 2,
margins = c(6,6), useRaster = FALSE, cexRow = 1.0, cexCol = 1.5, cellnote = ifelse(final_common_mrs_enabled_activity_matrix>0,"+","-"), notecex = 1, notecol = "black")
dev.off()
ordered_mrs_enabled <- rev(rownames(final_common_mrs_enabled_activity_matrix)[p1$rowInd])
ordered_p_values_inv_enabled <- NULL
for (i in 1:length(ordered_mrs_enabled))
{
mr <- ordered_mrs_enabled[i]
adj_pval <- inv_enabled_median_comparison[inv_enabled_median_comparison$MR==mr,]$Pval
temp <- cbind(mr,adj_pval)
ordered_p_values_inv_enabled <- rbind(ordered_p_values_inv_enabled,temp)
}
ordered_p_values_inv_enabled <- as.data.frame(ordered_p_values_inv_enabled)
colnames(ordered_p_values_inv_enabled) <- c("MR","Adj_Pval")
ordered_p_values_inv_enabled$MR <- as.character(as.vector(ordered_p_values_inv_enabled$MR))
ordered_p_values_inv_enabled$Adj_Pval <- as.numeric(as.vector(ordered_p_values_inv_enabled$Adj_Pval))
ordered_p_values_inv_enabled
write.table(ordered_p_values_inv_enabled,"../Results/Paper_Text/Ordered_Pvalues_INV_Enabled_MRs.csv",row.names=F,col.names=T,quote=F,sep=",")
mrs_of_interest_enabled <- inv_enabled_median_comparison[inv_enabled_median_comparison$FC_Median<0 &
inv_enabled_median_comparison$Pval<=0.05,]$MR
mrs_of_interest_enabled
enabled_activity_df <- NULL
for (cancer in INV_enabled)
{
load(paste0("../Results/",cancer,"/Adjacency_Matrix/",cancer,"_Full_Activity_matrix_FGSEA.Rdata"))
amat[amat>0] <- amat[amat>0]/max(amat)
amat[amat<0] <- amat[amat<0]/abs(min(amat))
#Load mechanistic network
#======================================================================================
load('../Data/Others/me_net_full.Rdata')
#Get the data
filename = cancer
out <- loading_data(filename,M)
D <- as.matrix(log2(t(out[[1]])+1))
#Get high and low indices
load(paste0("../Data/",filename,"/",filename,"_INV_cluster_assignment_k2-6_v2.Rdata"))
high_low_output <- get_high_low_indices(table_cluster_assignment,D)
table_cluster_assignment <- high_low_output[[1]]
high_indices <- high_low_output[[2]]
low_indices <- high_low_output[[3]]
for (topmr in mrs_of_interest_enabled)
{
high_activity <- amat[topmr,high_indices]
low_activity <- amat[topmr,low_indices]
enabled_activity_df <- rbind(enabled_activity_df,
cbind(rep(cancer,length(high_activity)+length(low_activity)),
rep(topmr,length(high_activity)+length(low_activity)),
c(rep("INV High",length(high_activity)),rep("INV Low",length(low_activity))),
c(high_activity,low_activity)))
}
}
enabled_activity_df <- as.data.frame(enabled_activity_df)
colnames(enabled_activity_df) <- c("Cancer","TopMR","Phenotype","Activity_Value")
enabled_activity_df$Cancer <- as.character(as.vector(enabled_activity_df$Cancer))
enabled_activity_df$TopMR <- as.character(as.vector(enabled_activity_df$TopMR))
enabled_activity_df$Phenotype <- as.character(as.vector(enabled_activity_df$Phenotype))
enabled_activity_df$Activity_Value <- as.numeric(as.vector(enabled_activity_df$Activity_Value))
supp_p3 <- ggplot(data = enabled_activity_df, aes(x=Cancer, y=Activity_Value)) +
geom_boxplot(aes(fill=Phenotype)) + facet_wrap( ~ TopMR, nrow=11, ncol=10) + xlab("Cancer") + ylab("Activity Value") +
geom_point(aes(y=Activity_Value, group=Phenotype), size=0.01, position = position_dodge(width=0.75))+
guides(fill=guide_legend(title="Phenotype")) + scale_fill_manual(values=c("red","blue")) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(axis.text.x = element_text(angle = -90)) +
ggtitle("Activities of Top MRs of specific to INV Low in INV Enabled Cancers (>=5 out of 10)") + theme(text = element_text(size=12)) + theme(plot.title = element_text(hjust = 0.5))
supp_p3
dev.off()
supp_p3 <- ggplot(data = enabled_activity_df, aes(x=Cancer, y=Activity_Value)) +
geom_boxplot(aes(fill=Phenotype)) + facet_wrap( ~ TopMR, nrow=8, ncol=8) + xlab("Cancer") + ylab("Activity Value") +
geom_point(aes(y=Activity_Value, group=Phenotype), size=0.01, position = position_dodge(width=0.75))+
guides(fill=guide_legend(title="Phenotype")) + scale_fill_manual(values=c("red","blue")) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(axis.text.x = element_text(angle = -90)) +
ggtitle("Activities of Top MRs of specific to INV Low in INV Enabled Cancers (>=5 out of 10)") + theme(text = element_text(size=12)) + theme(plot.title = element_text(hjust = 0.5))
supp_p3
mrs_of_interest_enabled
supp_p3 <- ggplot(data = enabled_activity_df, aes(x=Cancer, y=Activity_Value)) +
geom_boxplot(aes(fill=Phenotype)) + facet_wrap( ~ TopMR, nrow=9, ncol=8) + xlab("Cancer") + ylab("Activity Value") +
geom_point(aes(y=Activity_Value, group=Phenotype), size=0.01, position = position_dodge(width=0.75))+
guides(fill=guide_legend(title="Phenotype")) + scale_fill_manual(values=c("red","blue")) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(axis.text.x = element_text(angle = -90)) +
ggtitle("Activities of Top MRs of specific to INV Low in INV Enabled Cancers (>=5 out of 10)") + theme(text = element_text(size=12)) + theme(plot.title = element_text(hjust = 0.5))
supp_p3
supp_p3 <- ggplot(data = enabled_activity_df, aes(x=Cancer, y=Activity_Value)) +
geom_boxplot(aes(fill=Phenotype)) + facet_wrap( ~ TopMR, nrow=7, ncol=10) + xlab("Cancer") + ylab("Activity Value") +
geom_point(aes(y=Activity_Value, group=Phenotype), size=0.01, position = position_dodge(width=0.75))+
guides(fill=guide_legend(title="Phenotype")) + scale_fill_manual(values=c("red","blue")) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(axis.text.x = element_text(angle = -90)) +
ggtitle("Activities of Top MRs of specific to INV Low in INV Enabled Cancers (>=5 out of 10)") + theme(text = element_text(size=12)) + theme(plot.title = element_text(hjust = 0.5))
ggsave(file="../Results/Paper_Figures/Svgs_Jpgs/Supp_Figure_5.jpg",plot = supp_p3, device = jpeg(), width = 14, height=12, units = "in", dpi = 300)
dev.off()
inv_enabled_median_comparison <- inv_enabled_median_comparison[order(inv_enabled_median_comparison$FC_Median,decreasing = T),]
final_inv_enabled_median_comparison <- inv_enabled_median_comparison[inv_enabled_median_comparison$Pval<=0.05,]
final_inv_enabled_median_comparison$Pval <- as.numeric(as.vector(signif(final_inv_enabled_median_comparison$Pval,digits=6)))
final_inv_enabled_median_comparison
write.table(final_inv_enabled_median_comparison,file="../Results/Paper_Text/All_MRs_TFs_INV_Supplementary_Table_S4.csv",
row.names = F, col.names = T, sep = " & ", quote=F)
inv_low_specific_mrs <- inv_enabled_median_comparison[inv_enabled_median_comparison$FC_Median<0 &
inv_enabled_median_comparison$Pval<=0.05,]$MR
inv_high_specific_mrs <- inv_enabled_median_comparison[inv_enabled_median_comparison$FC_Median>0 &
inv_enabled_median_comparison$Pval<=0.05,]$MR
inv_low_specific_mrs
inv_high
inv_high_specific_mrs
91+65
rownames(D)
write.table(inv_low_specific_mrs,"../Results/Paper_Text/All_INV_Low_Specific_MRs.csv", row.names=F, col.names=F, quote=F)
write.table(inv_high_specific_mrs,"../Results/Paper_Text/All_INV_High_Specific_MRs.csv", row.names=F, col.names=F, quote=F)
write.table(rownames(D),"../Results/Paper_Text/Background_genes.csv", row.names=F, col.names=F, quote=F)
